# 📚 Course Pilot - 混合 RAG 后端

## 🎉 欢迎！

这是 Course Pilot 的**全新混合 RAG (检索增强生成)** 后端系统。已完全重构为云原生架构，使用 ChromaDB 向量搜索和 Groq 快速 LLM 推理。

---

## ⚡ 快速开始 (30 秒)

### 一键启动
```bash
./启动服务器.sh
```

就这么简单！脚本会自动：
- ✅ 设置你的 Groq API 密钥
- ✅ 检查并安装依赖
- ✅ 启动服务器

**首次运行**: 需要 2-3 分钟安装依赖和索引课程  
**后续运行**: 只需 5-10 秒

---

## 📖 文档 (全中文)

### 🚀 [快速开始.md](./快速开始.md)
- 3 种部署方式 (本地/Docker/Cloud Run)
- 包含你的 API 密钥
- 详细测试说明
- 故障排除指南

### 📦 [部署指南.md](./部署指南.md)
- 完整的 Cloud Run 部署步骤
- Docker 构建说明
- 环境变量配置
- 性能优化建议

### 🔬 [混合RAG详解.md](./混合RAG详解.md)
- 技术架构深入解析
- 向量搜索原理
- 混合评分公式
- 性能特征和调优

### 📝 [重构总结.md](./重构总结.md)
- 完整的重构过程
- 前后对比
- 性能提升数据
- 技术决策说明

---

## 🎯 核心特性

### 1. 混合搜索 (70% 语义 + 30% 关键词)
```
查询: "我想学机器学习"
结果: AI、ML、神经网络课程 ✅

查询: "15-112"
结果: 精确返回 15-112 课程 ✅
```

### 2. 超快 LLM (Groq)
- **旧系统**: 5-10 秒
- **新系统**: 200-500ms
- **提升**: 10-50 倍！⚡

### 3. 云原生部署
- Docker 容器化
- Google Cloud Run 就绪
- 自动扩展
- 无需 GPU

---

## 🛠️ 技术栈

| 组件 | 技术 | 用途 |
|-----|------|------|
| **向量数据库** | ChromaDB | 语义搜索 |
| **嵌入模型** | Sentence Transformers | 384维向量 |
| **LLM** | Groq (Llama 3.1 70B) | 快速推理 |
| **Web框架** | Flask | API 服务 |
| **生产服务器** | Gunicorn | 并发处理 |
| **容器** | Docker | 部署 |

---

## 📊 性能对比

| 指标 | 旧系统 | 新系统 | 提升 |
|-----|--------|--------|------|
| LLM 速度 | 5-10秒 | 0.2-0.5秒 | ⚡ **20倍** |
| 搜索质量 | 关键词 | 语义+关键词 | 🚀 **显著提升** |
| 内存占用 | 4-8GB | 2GB | 💾 **减少50%** |
| 部署方式 | 仅本地 | 云端 | 📈 **无限扩展** |

---

## 🔑 你的配置

### Groq API 密钥
```
gsk_your_key_here
```

已自动配置在 `启动服务器.sh` 中，无需手动设置！

---

## 🧪 测试

### 方式 1: 自动测试脚本
```bash
./test_backend.sh
```

### 方式 2: 手动测试
```bash
# 健康检查
curl http://localhost:8080/api/health

# 搜索课程
curl -X POST http://localhost:8080/api/courses/match \
  -H "Content-Type: application/json" \
  -d '{"goal": "机器学习", "skills": ["python"], "resume": "", "schedule": []}'
```

---

## 📁 项目结构

```
course_pilot/
├── backend/
│   ├── llm-proxy.py          ← 混合 RAG 核心代码
│   ├── requirements.txt      ← Python 依赖
│   └── chroma_db/            ← 向量数据库 (自动创建)
├── Dockerfile                ← Docker 配置
├── 启动服务器.sh             ← 一键启动脚本 ⭐
├── 快速开始.md               ← 新手指南 ⭐
├── 部署指南.md               ← 部署说明 ⭐
├── 混合RAG详解.md            ← 技术详解 ⭐
└── 重构总结.md               ← 重构总结 ⭐
```

---

## 🚀 部署选项

### 选项 1: 本地开发 (推荐新手)
```bash
./启动服务器.sh
```

### 选项 2: Docker
```bash
docker build -t course-pilot-backend .
docker run -p 8080:8080 -e GROQ_API_KEY=your_groq_api_key_here course-pilot-backend
```

### 选项 3: Google Cloud Run (生产环境)
```bash
# 详见 部署指南.md
gcloud run deploy course-pilot-backend \
  --image gcr.io/PROJECT/course-pilot-backend \
  --set-env-vars GROQ_API_KEY=gsk_...
```

---

## 💡 使用示例

### 示例 1: 语义搜索
```bash
curl -X POST http://localhost:8080/api/courses/match \
  -d '{"goal": "我想成为数据科学家"}'
```
**返回**: 数据分析、机器学习、统计学相关课程

### 示例 2: 精确课程
```bash
curl -X POST http://localhost:8080/api/courses/match \
  -d '{"goal": "15-112"}'
```
**返回**: 15-112 编程基础 (第一个结果)

### 示例 3: 时间表过滤
```bash
curl -X POST http://localhost:8080/api/courses/match \
  -d '{
    "goal": "人工智能",
    "schedule": [{"day": "M", "times": ["9:00 AM"]}]
  }'
```
**返回**: 仅周一 9AM 的 AI 课程

---

## 🆘 遇到问题？

### 常见问题

**Q: 端口 8080 被占用**
```bash
lsof -ti:8080 | xargs kill -9
```

**Q: 找不到模块 chromadb**
```bash
cd backend
pip install -r requirements.txt
```

**Q: 首次启动很慢**
- 正常！需要索引 3289 门课程 (30-60秒)
- 后续启动只需 5 秒

**Q: Groq API 错误**
- 检查 API 密钥是否正确
- 查看状态: https://status.groq.com/

---

## 📚 学习资源

- **ChromaDB**: https://docs.trychroma.com/
- **Groq API**: https://console.groq.com/docs
- **Sentence Transformers**: https://www.sbert.net/

---

## 🎓 Git 分支说明

- **rag** (当前分支) - 混合 RAG 系统 ⭐ 推荐
- **enhanced-ui-csv-data** - 旧版本 (llama.cpp)

---

## ✅ 下一步

1. ✅ 阅读 `快速开始.md`
2. ✅ 运行 `./启动服务器.sh`
3. ✅ 测试 API (`./test_backend.sh`)
4. 🔲 部署到 Cloud Run (可选)
5. 🔲 更新 Chrome Extension 端点

---

## 🎉 开始使用

**立即启动:**
```bash
./启动服务器.sh
```

**查看文档:**
- 新手: 阅读 `快速开始.md`
- 进阶: 阅读 `混合RAG详解.md`
- 部署: 阅读 `部署指南.md`

**祝你使用愉快！** 🚀
