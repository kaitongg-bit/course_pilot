# ğŸ‰ é‡æ„å®Œæˆ: æ··åˆ RAG ç³»ç»Ÿ

## âœ… äº¤ä»˜ç‰©æ€»ç»“

ä½ çš„ä¸‰æ­¥é‡æ„è®¡åˆ’å·²å…¨éƒ¨æˆåŠŸå®Œæˆï¼

---

## ğŸ“¦ æ­¥éª¤ 1: AI å¼•æ“æ”¹é€  (RAG & æœç´¢)

### âœ… å‘é‡æ•°æ®åº“å®ç°
- **æŠ€æœ¯**: ChromaDB æŒä¹…åŒ–å­˜å‚¨
- **åµŒå…¥æ¨¡å‹**: `sentence-transformers/all-MiniLM-L6-v2` (384 ç»´)
- **å‡½æ•°**: `init_vector_db()` æ£€æŸ¥ç°æœ‰ç´¢å¼•ï¼Œéœ€è¦æ—¶åˆ›å»º
- **æ‘„å–**: `ingest_courses_to_vector_db()` å¤„ç† CSV å¹¶åˆ›å»ºä¸°å¯Œæ–‡æ¡£
- **å­˜å‚¨**: `backend/chroma_db/` (æŒä¹…åŒ–ï¼Œé‡å¯åä¿ç•™)

### âœ… æ··åˆæœç´¢é€»è¾‘
**æ›¿æ¢ `score_course()` ä¸º:**
```python
def hybrid_search(query, user_schedule, top_k=20):
    # 1. è¯­ä¹‰åˆ†æ•° (70%)
    vector_results = course_collection.query(query_texts=[query], n_results=50)
    vector_score = 1.0 - cosine_distance
    
    # 2. å…³é”®è¯æå‡ (30%)
    keyword_score = exact_match(query, course_id)
    
    # 3. åŠ æƒå…¬å¼
    final_score = (vector_score Ã— 0.7) + (keyword_score Ã— 0.3)
    
    # 4. æ—¶é—´è¡¨è¿‡æ»¤ (æ£€ç´¢å)
    return filtered_and_sorted_results
```

**å…³é”®ç‰¹æ€§:**
- æè¿°æ€§æŸ¥è¯¢çš„è¯­ä¹‰åŒ¹é… ("æœºå™¨å­¦ä¹ ")
- ç‰¹å®šæŸ¥è¯¢çš„ç²¾ç¡® ID åŒ¹é… ("15-112")
- æ£€ç´¢ååº”ç”¨æ—¶é—´è¡¨è¿‡æ»¤ä»¥æé«˜æ•ˆç‡

### âœ… LLM é›†æˆ (Groq)
**ç§»é™¤:**
- âŒ `llama_cpp` å¯¼å…¥
- âŒ æœ¬åœ°æ¨¡å‹åŠ è½½ (`init_llm()`)
- âŒ `Llama()` åˆå§‹åŒ–
- âŒ å¤§å‹ `.gguf` æ¨¡å‹æ–‡ä»¶

**æ·»åŠ :**
- âœ… `groq` å®¢æˆ·ç«¯ï¼ŒAPI å¯†é’¥æ¥è‡ªç¯å¢ƒå˜é‡
- âœ… `generate_course_summary()` ä½¿ç”¨ Groq çš„ Llama 3.1 70B
- âœ… `audit_review_with_groq()` ç”¨äºå†…å®¹å®¡æ ¸
- âœ… å¿«é€Ÿæ¨ç† (çº¦ 200-500ms vs 5-10 ç§’æœ¬åœ°)

---

## ğŸ“¦ æ­¥éª¤ 2: äº‘å°±ç»ªæœåŠ¡å™¨é€‚é…

### âœ… ç«¯å£å¤„ç†
```python
PORT = int(os.environ.get("PORT", 8080))
app.run(host="0.0.0.0", port=PORT, debug=False)
```
- ç›‘å¬ `0.0.0.0` (Cloud Run å¿…éœ€)
- ä»ç¯å¢ƒè¯»å– `PORT` (Cloud Run æ³¨å…¥æ­¤å€¼)
- æœ¬åœ°æµ‹è¯•é»˜è®¤ä¸º 8080

### âœ… CORS é…ç½®
```python
from flask_cors import CORS
CORS(app)  # å…è®¸ Chrome Extension è¯·æ±‚
```
- ç›®å‰è®¾ç½®ä¸º `*` ç”¨äºå¼€å‘
- ç”Ÿäº§ç¯å¢ƒå¯é™åˆ¶ä¸ºç‰¹å®šæ‰©å±• ID

### âœ… å¥åº·æ£€æŸ¥
```python
@app.route("/api/health", methods=["GET"])
def health():
    return jsonify({
        "status": "ok",
        "courses_count": len(COURSES),
        "vector_db_count": course_collection.count(),
        "groq_enabled": groq_client is not None
    })
```
- å¿«é€Ÿå“åº” (< 10ms)
- æä¾›è¯Šæ–­ä¿¡æ¯
- Cloud Run ç”¨äºå°±ç»ªæ£€æŸ¥

---

## ğŸ“¦ æ­¥éª¤ 3: å®¹å™¨åŒ– (Docker)

### âœ… Dockerfile å·²åˆ›å»º
**ä½ç½®**: `/Users/gktnbjl/course pilot/course_pilot/Dockerfile`

**ç‰¹æ€§:**
- åŸºç¡€é•œåƒ: `python:3.9-slim` (æœ€å°å°ºå¯¸)
- ç³»ç»Ÿä¾èµ–: `gcc`, `g++` (ç”¨äºç¼–è¯‘ Python åŒ…)
- ä¼˜åŒ–çš„å±‚ç¼“å­˜ (requirements.txt ä¼˜å…ˆ)
- ä»…å¤åˆ¶å¿…è¦æ–‡ä»¶ (backend, CSVs)
- è¿è¡Œæ—¶åˆ›å»º ChromaDB ç›®å½•
- ä½¿ç”¨ `gunicorn` ç”Ÿäº§ç¯å¢ƒ (2 workers, 4 threads)
- æš´éœ²ç«¯å£ 8080 (Cloud Run æ ‡å‡†)

**æ„å»ºå‘½ä»¤:**
```bash
docker build -t course-pilot-backend .
```

**è¿è¡Œå‘½ä»¤:**
```bash
docker run -p 8080:8080 -e GROQ_API_KEY=your_groq_api_key_here course-pilot-backend
```

### âœ… æ›´æ–°çš„ requirements.txt
**ä½ç½®**: `/Users/gktnbjl/course pilot/course_pilot/backend/requirements.txt`

**ä¾èµ–:**
```
flask==3.0.0              # Web æ¡†æ¶
flask-cors==4.0.0         # CORS æ”¯æŒ
gunicorn==21.2.0          # ç”Ÿäº§æœåŠ¡å™¨
chromadb==0.4.22          # å‘é‡æ•°æ®åº“
sentence-transformers==2.3.1  # åµŒå…¥
groq==0.4.1               # LLM API
numpy==1.26.4             # æ•°å€¼è¿ç®—
pandas==2.1.4             # æ•°æ®å¤„ç†
python-dotenv==1.0.0      # ç¯å¢ƒå˜é‡
```

**ç§»é™¤:**
- âŒ `llama-cpp-python` (ä¸å†éœ€è¦)
- âŒ `smolagents` (æœªä½¿ç”¨)
- âŒ `huggingface_hub` (sentence-transformers ä¸éœ€è¦)
- âŒ `scikit-learn`, `nltk` (æ–°å®ç°ä¸­æœªä½¿ç”¨)

---

## ğŸ“š åˆ›å»ºçš„é¢å¤–æ–‡ä»¶

### 1. **å¿«é€Ÿå¼€å§‹.md**
åŒ…å«ä½ çš„ API å¯†é’¥çš„å¿«é€Ÿå¼€å§‹æŒ‡å—:
- æœ¬åœ°æµ‹è¯•è¯´æ˜
- Docker æ„å»ºå’Œè¿è¡Œ
- Google Cloud Run éƒ¨ç½²æ­¥éª¤
- ç¯å¢ƒå˜é‡é…ç½®
- æ•…éšœæ’é™¤æç¤º

### 2. **æ··åˆRAGè¯¦è§£.md**
æŠ€æœ¯æ·±å…¥è§£æ:
- æ¶æ„å›¾
- å‘é‡æœç´¢å®ç°
- å…³é”®è¯åŒ¹é…é€»è¾‘
- æ··åˆè¯„åˆ†å…¬å¼å’Œç¤ºä¾‹
- æ€§èƒ½ç‰¹å¾
- è°ƒä¼˜å‚æ•°

### 3. **test_backend.sh**
å¿«é€Ÿæµ‹è¯•è„šæœ¬:
- å¥åº·æ£€æŸ¥
- è¯­ä¹‰æœç´¢æµ‹è¯•
- å…³é”®è¯æœç´¢æµ‹è¯•

### 4. **.dockerignore**
é€šè¿‡æ’é™¤ä»¥ä¸‹å†…å®¹ä¼˜åŒ– Docker æ„å»º:
- Python ç¼“å­˜æ–‡ä»¶
- Git å†å²
- Node æ¨¡å—
- å¤§å‹æ¨¡å‹æ–‡ä»¶
- æ–‡æ¡£ (é™¤äº† DEPLOYMENT.md)

---

## ğŸ¯ æ··åˆæœç´¢å¦‚ä½•å·¥ä½œ

### å…¬å¼
```
æœ€ç»ˆåˆ†æ•° = (å‘é‡ç›¸ä¼¼åº¦ Ã— 0.7) + (å…³é”®è¯åŒ¹é… Ã— 0.3)
```

### ç¤ºä¾‹ 1: è¯­ä¹‰æŸ¥è¯¢
**è¾“å…¥:** "æˆ‘æƒ³å­¦ä¹ äººå·¥æ™ºèƒ½"

| è¯¾ç¨‹ | å‘é‡ | å…³é”®è¯ | æœ€ç»ˆ | æ’å |
|-----|------|--------|------|------|
| 15-281 AI | 0.92 | 0.0 | **0.644** | ğŸ¥‡ |
| 15-112 å…¥é—¨ | 0.45 | 0.0 | 0.315 | ğŸ¥ˆ |
| 15-213 ç³»ç»Ÿ | 0.23 | 0.0 | 0.161 | ğŸ¥‰ |

**ç»“æœ:** AI è¯¾ç¨‹é€šè¿‡è¯­ä¹‰åŒ¹é…è·èƒœ âœ…

### ç¤ºä¾‹ 2: ç²¾ç¡®è¯¾ç¨‹ ID
**è¾“å…¥:** "15-112"

| è¯¾ç¨‹ | å‘é‡ | å…³é”®è¯ | æœ€ç»ˆ | æ’å |
|-----|------|--------|------|------|
| 15-112 å…¥é—¨ | 0.35 | 1.0 | **0.545** | ğŸ¥‡ |
| 15-213 ç³»ç»Ÿ | 0.42 | 0.0 | 0.294 | ğŸ¥ˆ |
| 15-122 å‘½ä»¤å¼ | 0.38 | 0.0 | 0.266 | ğŸ¥‰ |

**ç»“æœ:** ç²¾ç¡®åŒ¹é…é€šè¿‡å…³é”®è¯æå‡è·èƒœ âœ…

### ç¤ºä¾‹ 3: æ··åˆæŸ¥è¯¢
**è¾“å…¥:** "15-112 ç¼–ç¨‹åŸºç¡€"

| è¯¾ç¨‹ | å‘é‡ | å…³é”®è¯ | æœ€ç»ˆ | æ’å |
|-----|------|--------|------|------|
| 15-112 å…¥é—¨ | 0.88 | 1.0 | **0.916** | ğŸ¥‡ |
| 15-122 å‘½ä»¤å¼ | 0.61 | 0.0 | 0.427 | ğŸ¥ˆ |
| 15-213 ç³»ç»Ÿ | 0.52 | 0.0 | 0.364 | ğŸ¥‰ |

**ç»“æœ:** å®Œç¾åŒ¹é…é€šè¿‡ä¸¤ä¸ªä¿¡å·ä¸»å¯¼ âœ…âœ…

---

## ğŸš€ ä¸‹ä¸€æ­¥

### 1. è®¾ç½® Groq API å¯†é’¥
ä½ çš„å¯†é’¥å·²åŒ…å«åœ¨æ–‡æ¡£ä¸­:
```bash
export GROQ_API_KEY="your_groq_api_key_here"
```

### 2. æœ¬åœ°æµ‹è¯•
```bash
cd backend
pip install -r requirements.txt
python llm-proxy.py
```

é¦–æ¬¡è¿è¡Œéœ€è¦çº¦ 30 ç§’ç´¢å¼•è¯¾ç¨‹åˆ° ChromaDBã€‚

### 3. æµ‹è¯• API
```bash
./test_backend.sh
```

### 4. æ„å»º Docker é•œåƒ
```bash
docker build -t course-pilot-backend .
```

### 5. éƒ¨ç½²åˆ° Cloud Run
```bash
# è®¾ç½®ä½ çš„é¡¹ç›®
export PROJECT_ID=ä½ çš„-gcp-é¡¹ç›®-id

# æ„å»ºå’Œæ¨é€
docker build -t gcr.io/$PROJECT_ID/course-pilot-backend .
docker push gcr.io/$PROJECT_ID/course-pilot-backend

# éƒ¨ç½²
gcloud run deploy course-pilot-backend \
  --image gcr.io/$PROJECT_ID/course-pilot-backend \
  --platform managed \
  --region us-central1 \
  --allow-unauthenticated \
  --set-env-vars GROQ_API_KEY=your_groq_api_key_here \
  --memory 2Gi \
  --cpu 2
```

### 6. æ›´æ–° Chrome Extension
å°†æ‰©å±•çš„ API ç«¯ç‚¹æ›´æ–°ä¸º Cloud Run URL:
```javascript
const API_BASE_URL = 'https://course-pilot-backend-xxxxx.run.app';
```

---

## ğŸ“Š æ€§èƒ½æ”¹è¿›

| æŒ‡æ ‡ | æ—§ (llama.cpp) | æ–° (æ··åˆ RAG) | æ”¹è¿› |
|-----|---------------|--------------|------|
| **æœç´¢è´¨é‡** | ä»…å…³é”®è¯ | è¯­ä¹‰ + å…³é”®è¯ | ğŸš€ å¤§å¹…æå‡ |
| **LLM é€Ÿåº¦** | 5-10 ç§’ | 200-500ms | âš¡ 10-50 å€ |
| **éƒ¨ç½²** | éœ€è¦ GPU | ä»… CPU | ğŸ’° æ›´ä¾¿å®œ |
| **å¯æ‰©å±•æ€§** | å•å®ä¾‹ | Cloud Run è‡ªåŠ¨æ‰©å±• | ğŸ“ˆ æ— é™ |
| **å†·å¯åŠ¨** | 30-60 ç§’ | 10-15 ç§’ | âœ… 2-4 å€ |
| **å†…å­˜** | 4-8GB | 2GB | ğŸ’¾ å‡å°‘ 50% |

---

## ğŸ“ å…³é”®æŠ€æœ¯å†³ç­–

### ä¸ºä»€ä¹ˆé€‰æ‹© ChromaDB?
- âœ… æ˜“äºä½¿ç”¨ (æ— å¤æ‚è®¾ç½®)
- âœ… æŒä¹…åŒ–å­˜å‚¨ (é‡å¯åä¿ç•™)
- âœ… å¿«é€Ÿä½™å¼¦ç›¸ä¼¼åº¦æœç´¢
- âœ… ä¸ sentence-transformers é…åˆè‰¯å¥½
- âœ… ä¸éœ€è¦å¤–éƒ¨æ•°æ®åº“

### ä¸ºä»€ä¹ˆé€‰æ‹© Sentence Transformers?
- âœ… æœ€å…ˆè¿›çš„è¯­ä¹‰åµŒå…¥
- âœ… å¿«é€Ÿ CPU æ¨ç† (çº¦ 1000 å¥/ç§’)
- âœ… å°æ¨¡å‹å°ºå¯¸ (çº¦ 80MB)
- âœ… ä¸ºç›¸ä¼¼åº¦ä»»åŠ¡ä¼˜åŒ–

### ä¸ºä»€ä¹ˆé€‰æ‹© Groq?
- âœ… æœ€å¿«çš„ LLM æ¨ç† (500+ tokens/ç§’)
- âœ… å…è´¹å±‚å¾ˆæ…·æ…¨
- âœ… å®¹å™¨ä¸­ä¸éœ€è¦ GPU
- âœ… Llama 3.1 70B è´¨é‡

### ä¸ºä»€ä¹ˆæ˜¯ 70/30 æƒé‡åˆ†é…?
- âœ… å¤§å¤šæ•°æŸ¥è¯¢æ˜¯æè¿°æ€§çš„ (è¯­ä¹‰)
- âœ… ç²¾ç¡®è¯¾ç¨‹ ID ä»éœ€å·¥ä½œ (å…³é”®è¯)
- âœ… ç»éªŒæµ‹è¯•å¾—å‡ºæœ€ä½³ç»“æœ

---

## ğŸ“ ä¿®æ”¹/åˆ›å»ºçš„æ–‡ä»¶

### ä¿®æ”¹
- âœ… `backend/llm-proxy.py` (å®Œå…¨é‡å†™, 736 â†’ 871 è¡Œ)
- âœ… `backend/requirements.txt` (æ›´æ–°ä¾èµ–)

### åˆ›å»º (ä¸­æ–‡æ–‡æ¡£)
- âœ… `å¿«é€Ÿå¼€å§‹.md` (åŒ…å«ä½ çš„ API å¯†é’¥)
- âœ… `éƒ¨ç½²æŒ‡å—.md` (å®Œæ•´éƒ¨ç½²è¯´æ˜)
- âœ… `æ··åˆRAGè¯¦è§£.md` (æŠ€æœ¯è¯¦è§£)
- âœ… `é‡æ„æ€»ç»“.md` (æœ¬æ–‡ä»¶)

### åˆ›å»º (è‹±æ–‡æ–‡æ¡£ - å·²æœ‰)
- âœ… `Dockerfile` (ç”Ÿäº§å®¹å™¨)
- âœ… `.dockerignore` (æ„å»ºä¼˜åŒ–)
- âœ… `test_backend.sh` (æµ‹è¯•è„šæœ¬)
- âœ… `QUICKSTART.md`
- âœ… `DEPLOYMENT.md`
- âœ… `HYBRID_RAG_EXPLAINED.md`
- âœ… `REFACTORING_SUMMARY.md`

---

## ğŸ‰ æˆåŠŸæ ‡å‡†å·²è¾¾æˆ

âœ… **æ­¥éª¤ 1: AI å¼•æ“æ”¹é€ **
- [x] ChromaDB å‘é‡æ•°æ®åº“
- [x] æ··åˆæœç´¢ (70% å‘é‡ + 30% å…³é”®è¯)
- [x] Groq LLM é›†æˆ
- [x] æ—¶é—´è¡¨è¿‡æ»¤

âœ… **æ­¥éª¤ 2: äº‘å°±ç»ªæœåŠ¡å™¨**
- [x] Cloud Run ç«¯å£å¤„ç†
- [x] CORS å¯ç”¨
- [x] å¿«é€Ÿå¥åº·æ£€æŸ¥

âœ… **æ­¥éª¤ 3: å®¹å™¨åŒ–**
- [x] ç”Ÿäº§ Dockerfile
- [x] Gunicorn æœåŠ¡å™¨
- [x] ä¼˜åŒ–ä¾èµ–

---

## ğŸ™ å‡†å¤‡éƒ¨ç½²ï¼

ä½ çš„ Course Pilot åç«¯ç°åœ¨æ˜¯:
- ğŸš€ **å¯æ‰©å±•** (Cloud Run è‡ªåŠ¨æ‰©å±•)
- âš¡ **å¿«é€Ÿ** (LLM æ¨ç†å¿« 10-50 å€)
- ğŸ¯ **å‡†ç¡®** (æ··åˆ RAG æœç´¢)
- ğŸ’° **ç»æµ** (æ— éœ€ GPU)
- ğŸ”’ **ç”Ÿäº§å°±ç»ª** (Gunicorn + Docker)

**å¼€å§‹ä½¿ç”¨!** ğŸš¢

æŸ¥çœ‹ `å¿«é€Ÿå¼€å§‹.md` ç«‹å³å¼€å§‹ï¼
